local Library = loadstring(game:HttpGet("https://api.junkie-development.de/api/v1/luascripts/public/eb7222cf54839e8674e21eab83982947e49f0fa4f7b3f30e8f79f8d95de72390/download"))()

local Window = Library:Window({
    Name = "Nevox BBR",
    SubName = "by Madness idk",
    Logo = "120959262762131"
})

local KeybindList = Library:KeybindList("Keybinds")

-- Categories & Pages
Window:Category("Main Features")
local MainPage = Window:Page({Name = "Main", Icon = "134236649319095"})
local CombatPage = Window:Page({Name = "Combat", Icon = "100050851789190"})

Window:Category("Visual")
local ESPPage = Window:Page({Name = "ESP", Icon = "138827881557940", Columns = 1})

Window:Category("Settings")
local SettingsPage = Library:CreateSettingsPage(Window, KeybindList)

-- Services & Packets
local rs = game:GetService("ReplicatedStorage")
local packets
local success, err = pcall(function()
    packets = require(rs.Modules.Packets)
end)
if not success then
    Library:Notification({
        Title = "Warning",
        Description = "Failed to load packets module",
        Duration = 5,
        Icon = "73789337996373"
    })
end

local plr = game.Players.LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()
local root = char:WaitForChild("HumanoidRootPart")
local hum = char:WaitForChild("Humanoid")
local runs = game:GetService("RunService")
local uis = game:GetService("UserInputService")

-- Original values
local originalValues = {
    WalkSpeed = hum.WalkSpeed,
    JumpPower = hum.JumpPower,
    HipHeight = hum.HipHeight,
    MaxSlopeAngle = hum.MaxSlopeAngle
}

-- ESP Variables
local espEnabled = false
local espShowHP = true
local espShowArmor = true
local espShowWeapon = true
local espMaxDistance = 2500
local espShowCritters = true
local espShowResources = true

-- Auto Heal / Eat Variables
local autoHealEnabled = false
local autoEatEnabled = false
local autoHealFruit = "Bloodfruit"
local autoEatFruit = "Coconut"
local autoHealThreshold = 90
local autoEatThreshold = 90
local autoEatCPS = 3
local lastUseTime = 0

-- Kill Aura Variables
local killAuraEnabled = false
local killAuraRange = 8
local killAuraMaxTargets = 3
local killAuraCooldown = 0.08

-- Double Jump Variables
local canDoubleJump = false
local hasDoubleJumped = false
local doubleJumpConnections = {}
local doubleJumpEnabled = false

-- =================== MAIN TAB (Player Stats + Utilities) ===================
local PlayerSection = MainPage:Section({Name = "Player Stats", Description = "Modify your player stats", Side = 1})

local wstoggle = PlayerSection:Toggle({
    Name = "Walkspeed",
    Flag = "WalkSpeedToggle",
    Default = false,
    Callback = function(v) updateWalkspeed(v) end
})

local wsslider = PlayerSection:Slider({
    Name = "Walkspeed Value",
    Flag = "WalkSpeedValue",
    Min = 10, Max = 30, Suffix = "studs", Default = 16, Decimals = 1,
    Callback = function(v) if wstoggle:Get() then hum.WalkSpeed = v end end
})

local jptoggle = PlayerSection:Toggle({
    Name = "JumpPower",
    Flag = "JumpPowerToggle",
    Default = false,
    Callback = function(v) updateJumpPower(v) end
})

local jpslider = PlayerSection:Slider({
    Name = "JumpPower Value",
    Flag = "JumpPowerValue",
    Min = 30, Max = 100, Suffix = "power", Default = 50, Decimals = 1,
    Callback = function(v) if jptoggle:Get() then hum.JumpPower = v end end
})

local hheighttoggle = PlayerSection:Toggle({
    Name = "HipHeight",
    Flag = "HipHeightToggle",
    Default = false,
    Callback = function(v) updateHipHeight(v) end
})

local hheightslider = PlayerSection:Slider({
    Name = "HipHeight Value",
    Flag = "HipHeightValue",
    Min = 0.1, Max = 10, Suffix = "studs", Default = 2, Decimals = 1,
    Callback = function(v) if hheighttoggle:Get() then hum.HipHeight = v end end
})

local msatoggle = PlayerSection:Toggle({
    Name = "No Mountain Slip",
    Flag = "NoSlipToggle",
    Default = false,
    Callback = function(v) updateNoSlip(v) end
})

local doublejumptoggle = PlayerSection:Toggle({
    Name = "Double Jump",
    Flag = "DoubleJumpToggle",
    Default = false,
    Callback = function(v) updateDoubleJump(v) end
})

local UtilitySection = MainPage:Section({Name = "Utilities", Side = 2})

UtilitySection:Button({
    Name = "Reset Character",
    Callback = function()
        if char then
            char:BreakJoints()
        end
    end
})

-- =================== COMBAT TAB ===================
local CombatSection = CombatPage:Section({Name = "Kill Aura", Side = 1})

local kauratoggle = CombatSection:Toggle({
    Name = "Kill Aura",
    Flag = "KillAuraToggle",
    Default = false,
    Callback = function(v) killAuraEnabled = v end
})

local kaurarange = CombatSection:Slider({
    Name = "Range",
    Flag = "KillAuraRange",
    Min = 1, Max = 12, Suffix = "studs", Default = 8, Decimals = 1,
    Callback = function(v) killAuraRange = v end
})

local kaumax = CombatSection:Dropdown({
    Name = "Max Targets",
    Flag = "KillAuraMax",
    Default = "3",
    Items = {"1","2","3","4","5","6"},
    Callback = function(v) killAuraMaxTargets = tonumber(v) end
})

local kaCooldown = CombatSection:Slider({
    Name = "Attack Cooldown",
    Flag = "KillAuraCD",
    Min = 0.05, Max = 0.5, Suffix = "s", Default = 0.08, Decimals = 2,
    Callback = function(v) killAuraCooldown = v end
})

local AutoHealSection = CombatPage:Section({Name = "Auto Heal & Eat", Side = 2})

local healToggle = AutoHealSection:Toggle({
    Name = "Auto Heal",
    Flag = "AutoHeal",
    Default = false,
    Callback = function(v) autoHealEnabled = v end
})

local healFruit = AutoHealSection:Dropdown({
    Name = "Heal Fruit",
    Flag = "HealFruit",
    Default = "Bloodfruit",
    Items = {"Bloodfruit","Bluefruit","Lemon","Coconut","Jelly","Banana","Orange","Berry"},
    Callback = function(v) autoHealFruit = v end
})

local healThresh = AutoHealSection:Slider({
    Name = "Heal Below %",
    Flag = "HealThresh",
    Min = 1, Max = 100, Suffix = "%", Default = 90,
    Callback = function(v) autoHealThreshold = v end
})

local eatToggle = AutoHealSection:Toggle({
    Name = "Auto Eat",
    Flag = "AutoEat",
    Default = false,
    Callback = function(v) autoEatEnabled = v end
})

local eatFruit = AutoHealSection:Dropdown({
    Name = "Eat Fruit",
    Flag = "EatFruit",
    Default = "Coconut",
    Items = {"Coconut","Bloodfruit","Bluefruit","Lemon","Jelly","Banana","Orange","Berry"},
    Callback = function(v) autoEatFruit = v end
})

local eatThresh = AutoHealSection:Slider({
    Name = "Eat Below %",
    Flag = "EatThresh",
    Min = 1, Max = 100, Suffix = "%", Default = 90,
    Callback = function(v) autoEatThreshold = v end
})

local eatCPS = AutoHealSection:Slider({
    Name = "Eat Speed (CPS)",
    Flag = "EatCPS",
    Min = 1, Max = 8, Suffix = "cps", Default = 3,
    Callback = function(v) autoEatCPS = v end
})

-- =================== ESP TAB ===================
local ESPSection = ESPPage:Section({Name = "Player ESP", Side = 1})

local esptoggle = ESPSection:Toggle({
    Name = "Enable Player ESP",
    Flag = "PlayerESP",
    Default = false,
    Callback = function(v)
        espEnabled = v
        if not v then clearESP() else createESPForAllPlayers() end
    end
})

local esphealth = ESPSection:Toggle({Name = "Show HP", Default = true, Callback = function(v) espShowHP = v end})
local esparmor = ESPSection:Toggle({Name = "Show Armor", Default = true, Callback = function(v) espShowArmor = v end})
local espweapon = ESPSection:Toggle({Name = "Show Weapon", Default = true, Callback = function(v) espShowWeapon = v end})

ESPSection:Toggle({
    Name = "Critter ESP",
    Default = true,
    Callback = function(v) espShowCritters = v end
})

ESPSection:Toggle({
    Name = "Resource ESP",
    Default = true,
    Callback = function(v) espShowResources = v end
})

local esprange = ESPSection:Slider({
    Name = "Max Distance",
    Flag = "ESPRange",
    Min = 0, Max = 5000, Suffix = "m", Default = 2500, Decimals = 1,
    Callback = function(v) espMaxDistance = v end
})

-- =================== FUNCTIONS ===================
local walkConn, jumpConn, hipConn, slopeConn

function updateWalkspeed(enabled)
    if walkConn then walkConn:Disconnect() walkConn = nil end
    if enabled then
        hum.WalkSpeed = wsslider:Get()
        walkConn = runs.RenderStepped:Connect(function()
            if hum and hum.Parent then hum.WalkSpeed = wsslider:Get() end
        end)
    else
        hum.WalkSpeed = originalValues.WalkSpeed
    end
end

function updateJumpPower(enabled)
    if jumpConn then jumpConn:Disconnect() jumpConn = nil end
    if enabled then
        hum.JumpPower = jpslider:Get()
        jumpConn = runs.RenderStepped:Connect(function()
            if hum and hum.Parent then hum.JumpPower = jpslider:Get() end
        end)
    else
        hum.JumpPower = originalValues.JumpPower
    end
end

function updateHipHeight(enabled)
    if hipConn then hipConn:Disconnect() hipConn = nil end
    if enabled then
        hum.HipHeight = hheightslider:Get()
        hipConn = runs.RenderStepped:Connect(function()
            if hum and hum.Parent then hum.HipHeight = hheightslider:Get() end
        end)
    else
        hum.HipHeight = originalValues.HipHeight
    end
end

function updateNoSlip(enabled)
    if slopeConn then slopeConn:Disconnect() slopeConn = nil end
    if enabled then
        hum.MaxSlopeAngle = 89.9
        slopeConn = runs.RenderStepped:Connect(function()
            if hum and hum.Parent then hum.MaxSlopeAngle = 89.9 end
        end)
    else
        hum.MaxSlopeAngle = originalValues.MaxSlopeAngle
    end
end

function updateDoubleJump(enabled)
    for _, c in pairs(doubleJumpConnections) do c:Disconnect() end
    doubleJumpConnections = {}
    doubleJumpEnabled = enabled

    if enabled then
        canDoubleJump = false
        hasDoubleJumped = false

        local ground = runs.RenderStepped:Connect(function()
            if hum and hum.Parent then
                if hum.FloorMaterial ~= Enum.Material.Air then
                    hasDoubleJumped = false
                    canDoubleJump = true
                end
            end
        end)

        local input = uis.InputBegan:Connect(function(inp, gp)
            if gp or not hum or not hum.Parent then return end
            if inp.KeyCode == Enum.KeyCode.Space and hum.FloorMaterial == Enum.Material.Air and canDoubleJump then
                root.Velocity = Vector3.new(root.Velocity.X, jpslider:Get() * 1.6, root.Velocity.Z)
                hasDoubleJumped = true
                canDoubleJump = false
            end
        end)

        table.insert(doubleJumpConnections, ground)
        table.insert(doubleJumpConnections, input)
    end
end

-- ESP Functions
function createESP(obj, name, color)
    local bgui = Instance.new("BillboardGui", game.CoreGui)
    bgui.Name = name .. "_ESP"
    bgui.AlwaysOnTop = true
    bgui.Size = UDim2.new(0, 200, 0, 50)
    bgui.ExtentsOffset = Vector3.new(0, 3, 0)

    local label = Instance.new("TextLabel", bgui)
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = color or Color3.new(1,1,1)
    label.TextStrokeTransparency = 0
    label.Font = Enum.Font.GothamBold
    label.TextSize = 16

    runs.RenderStepped:Connect(function()
        if not espEnabled or not obj or not obj:FindFirstChild("HumanoidRootPart" or "PrimaryPart") then
            bgui.Enabled = false
            return
        end
        local part = obj:FindFirstChild("HumanoidRootPart") or obj.PrimaryPart
        local dist = (part.Position - root.Position).Magnitude
        if dist > espMaxDistance then
            bgui.Enabled = false
            return
        end
        bgui.Adornee = part
        bgui.Enabled = true
        label.Text = name .. " [" .. math.floor(dist) .. "m]"
    end)
end

function createPlayerESP(p)
    if p == plr then return end
    local bgui = Instance.new("BillboardGui", game.CoreGui)
    bgui.Name = p.Name .. "_PlayerESP"
    bgui.AlwaysOnTop = true
    bgui.Size = UDim2.new(0, 250, 0, 100)
    bgui.ExtentsOffset = Vector3.new(0, 3.5, 0)

    local container = Instance.new("Frame", bgui)
    container.Size = UDim2.new(1,0,1,0)
    container.BackgroundTransparency = 1

    local nameLabel = Instance.new("TextLabel", container)
    nameLabel.Size = UDim2.new(1,0,0,22)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = 18
    nameLabel.TextStrokeTransparency = 0

    local infoLabel = Instance.new("TextLabel", container)
    infoLabel.Position = UDim2.new(0,0,0,22)
    infoLabel.Size = UDim2.new(1,0,0,18)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.GothamBold
    infoLabel.TextSize = 14
    infoLabel.TextStrokeTransparency = 0

    runs.RenderStepped:Connect(function()
        local tChar = workspace.Players:FindFirstChild(p.Name)
        if not espEnabled or not tChar or not tChar:FindFirstChild("HumanoidRootPart") then
            bgui.Enabled = false return
        end
        local dist = (tChar.HumanoidRootPart.Position - root.Position).Magnitude
        if dist > espMaxDistance then bgui.Enabled = false return end

        bgui.Adornee = tChar.HumanoidRootPart
        bgui.Enabled = true

        local color = p.TeamColor and p.TeamColor.Color or Color3.fromRGB(255,100,100)
        nameLabel.TextColor3 = color
        infoLabel.TextColor3 = color
        nameLabel.Text = p.Name .. " [" .. math.floor(dist) .. "m]"

        local details = {}
        if espShowHP and tChar:FindFirstChild("Humanoid") then
            table.insert(details, "HP: " .. math.floor(tChar.Humanoid.Health))
        end
        if espShowArmor then
            local armor = {}
            for _, v in pairs(tChar:GetChildren()) do
                if v.Name:lower():find("chest") or v.Name:lower():find("greaves") or v.Name:lower():find("helmet") then
                    table.insert(armor, v.Name:match("^%u%l+"))
                end
            end
            table.insert(details, "A: " .. (#armor > 0 and table.concat(armor,"/") or "None"))
        end
        if espShowWeapon then
            local tool = tChar:FindFirstChild("Tools")
            local weapon = tool and (tool:FindFirstChildWhichIsA("Model") or tool:FindFirstChildWhichIsA("BasePart"))
            table.insert(details, "W: " .. (weapon and weapon.Name or "None"))
        end
        infoLabel.Text = table.concat(details, " â€¢ ")
    end)
end

function createESPForAllPlayers()
    for _, p in pairs(game.Players:GetPlayers()) do
        if p ~= plr then createPlayerESP(p) end
    end
end

function clearESP()
    for _, obj in pairs(game.CoreGui:GetChildren()) do
        if obj:IsA("BillboardGui") and obj.Name:find("_ESP") then
            obj:Destroy()
        end
    end
end

-- Critter & Resource ESP
task.spawn(function()
    while task.wait(3) do
        if not espEnabled then continue end
        if espShowCritters then
            for _, critter in pairs(workspace.Critters:GetChildren()) do
                if critter:IsA("Model") and not game.CoreGui:FindFirstChild(critter.Name .. "_ESP") then
                    createESP(critter, critter.Name, Color3.fromRGB(0,255,0))
                end
            end
        end
        if espShowResources then
            for _, res in pairs(workspace.Resources:GetChildren()) do
                if res:IsA("Model") and not game.CoreGui:FindFirstChild(res.Name .. "_ESP") then
                    createESP(res, res.Name, Color3.fromRGB(255,255,0))
                end
            end
        end
    end
end)

-- Kill Aura Loop
task.spawn(function()
    while task.wait(killAuraCooldown) do
        if not killAuraEnabled then continue end
        local targets = {}
        for _, p in pairs(game.Players:GetPlayers()) do
            if p ~= plr then
                local folder = workspace.Players:FindFirstChild(p.Name)
                if folder and folder:GetAttribute("EntityID") then
                    local hrp = folder:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        local dist = (hrp.Position - root.Position).Magnitude
                        if dist <= killAuraRange then
                            table.insert(targets, {id = folder:GetAttribute("EntityID"), dist = dist})
                        end
                    end
                end
            end
        end
        if #targets > 0 then
            table.sort(targets, function(a,b) return a.dist < b.dist end)
            local toHit = {}
            for i = 1, math.min(killAuraMaxTargets, #targets) do
                table.insert(toHit, targets[i].id)
            end
            if packets and packets.SwingTool and packets.SwingTool.send then
                packets.SwingTool.send(toHit)
            end
        end
    end
end)

-- Auto Heal & Eat Loop
task.spawn(function()
    while task.wait(0.1) do
        local delay = 1 / autoEatCPS
        if tick() - lastUseTime < delay then continue end

        local inv = plr.PlayerGui.MainGui.RightPanel.Inventory:FindFirstChild("List")
        if not inv then continue end

        if autoHealEnabled then
            local hp = pcall(function()
                return tonumber(plr.PlayerGui.MainGui.Panels.Stats.Bars.Health.ValueLabel.Text:match("%d+")) or 100
            end) and _ or 100
            if hp < autoHealThreshold then
                local item = inv:FindFirstChild(autoHealFruit)
                if item and packets and packets.UseBagItem then
                    packets.UseBagItem.send(item.LayoutOrder)
                    lastUseTime = tick()
                end
            end
        end

        if autoEatEnabled then
            local hunger = pcall(function()
                return tonumber(plr.PlayerGui.MainGui.Panels.Stats.Bars.Hunger.ValueLabel.Text:match("%d+")) or 100
            end) and _ or 100
            if hunger < autoEatThreshold then
                local item = inv:FindFirstChild(autoEatFruit)
                if item and packets and packets.UseBagItem then
                    packets.UseBagItem.send(item.LayoutOrder)
                    lastUseTime = tick()
                end
            end
        end
    end
end)

-- Character Reset Handler
plr.CharacterAdded:Connect(function(newChar)
    char = newChar
    root = char:WaitForChild("HumanoidRootPart")
    hum = char:WaitForChild("Humanoid")

    originalValues = {
        WalkSpeed = hum.WalkSpeed,
        JumpPower = hum.JumpPower,
        HipHeight = hum.HipHeight,
        MaxSlopeAngle = hum.MaxSlopeAngle
    }

    canDoubleJump = false
    hasDoubleJumped = false

    if wstoggle:Get() then updateWalkspeed(true) end
    if jptoggle:Get() then updateJumpPower(true) end
    if hheighttoggle:Get() then updateHipHeight(true) end
    if msatoggle:Get() then updateNoSlip(true) end
    if doublejumptoggle:Get() then updateDoubleJump(true) end
end)

-- ESP Player Join/Leave
game.Players.PlayerAdded:Connect(function(p)
    if p ~= plr then createPlayerESP(p) end
end)

game.Players.PlayerRemoving:Connect(function(p)
    local esp = game.CoreGui:FindFirstChild(p.Name .. "_PlayerESP")
    if esp then esp:Destroy() end
end)

createESPForAllPlayers()

Library:Notification({
    Title = "Nevox BBR Loaded",
    Description = "ESP, Player mods, Kill Aura, Auto Heal/Eat ready!",
    Duration = 5,
    Icon = "73789337996373"
})

Window:Init()
getgenv().Library = Library
