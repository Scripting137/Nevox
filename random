local Library = loadstring(game:HttpGet("https://api.junkie-development.de/api/v1/luascripts/public/eb7222cf54839e8674e21eab83982947e49f0fa4f7b3f30e8f79f8d95de72390/download"))()

local Window = Library:Window({
    Name = "Nevox BBR",
    SubName = "by Madness idk",
    Logo = "120959262762131"
})

local KeybindList = Library:KeybindList("Keybinds")

-- Categories & Pages
Window:Category("Main Features")
local MainPage = Window:Page({Name = "Main", Icon = "134236649319095"})
local CombatPage = Window:Page({Name = "Combat", Icon = "100050851789190"})
local PickupPage = Window:Page({Name = "Pickup", Icon = "108839695397679"})
local FarmingPage = Window:Page({Name = "Farming", Icon = "123554105934637"})

Window:Category("Visual")
local ESPPage = Window:Page({Name = "ESP", Icon = "138827881557940", Columns = 1})

Window:Category("Settings")
local SettingsPage = Library:CreateSettingsPage(Window, KeybindList)

-- Services & Packets
local rs = game:GetService("ReplicatedStorage")
local packets = require(rs.Modules.Packets) or nil
if not packets then
    Library:Notification({Title = "Error", Description = "Packets not found!", Duration = 5})
end

local plr = game.Players.LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()
local root = char:WaitForChild("HumanoidRootPart")
local hum = char:WaitForChild("Humanoid")
local runs = game:GetService("RunService")
local uis = game:GetService("UserInputService")

-- Original values
local originalValues = {
    WalkSpeed = hum.WalkSpeed,
    JumpPower = hum.JumpPower,
    HipHeight = hum.HipHeight,
    MaxSlopeAngle = hum.MaxSlopeAngle
}

-- ESP Variables
local espPlayerEnabled = false
local espCritterEnabled = false
local espResourceEnabled = false
local espShowHP = true
local espShowArmor = true
local espShowWeapon = true
local espMaxDistance = 2500

-- Auto Heal / Eat Variables
local autoHealEnabled = false
local autoEatEnabled = false
local autoHealFruit = "Bloodfruit"
local autoEatFruit = "Coconut"
local autoHealThreshold = 90
local autoEatThreshold = 90
local autoEatCPS = 3
local lastUseTime = 0

-- Kill Aura Variables
local killAuraEnabled = false
local killAuraRange = 8
local killAuraMaxTargets = 3
local killAuraCooldown = 0.1

-- Pickup Variables
local autoPickupEnabled = false
local pickupRange = 20
local selectedItems = {"Leaves", "Log"}
local customPickupEnabled = false
local customPickupText = ""
local autoDropEnabled = false
local dropItem = "Bloodfruit"
local autoDropCustomEnabled = false
local customDropItem = "Bloodfruit"

-- Farming Variables
local plantToggle = false
local plantRange = 30
local plantDelay = 0.1
local selectedFruit = "Bloodfruit"

-- Double Jump Variables
local canDoubleJump = false
local hasDoubleJumped = false
local doubleJumpConnections = {}
local doubleJumpEnabled = false

-- Fruit ID Map
local fruitToItemId = {
    Bloodfruit = 94,
    Bluefruit = 377,
    Lemon = 99,
    Coconut = 1,
    Jelly = 604,
    Banana = 606,
    Orange = 602,
    Berry = 35,
    -- Add more if needed
}

-- All Items for Pickup/Drop
local allItems = {"Berry", "Bloodfruit", "Bluefruit", "Lemon", "Strawberry", "Gold", "Leaves", "Log", "Wood", "All"}

-- =================== MAIN TAB ===================
local PlayerSection = MainPage:Section({Name = "Player Stats", Side = 1})

local wstoggle = PlayerSection:Toggle({Name = "Walkspeed", Default = false, Callback = function(v) updateWalkspeed(v) end})
local wsslider = PlayerSection:Slider({Name = "Walkspeed Value", Min = 10, Max = 30, Suffix = "studs", Default = 16, Decimals = 1, Callback = function(v) if wstoggle:Get() then hum.WalkSpeed = v end end})
local jptoggle = PlayerSection:Toggle({Name = "JumpPower", Default = false, Callback = function(v) updateJumpPower(v) end})
local jpslider = PlayerSection:Slider({Name = "JumpPower Value", Min = 30, Max = 100, Suffix = "power", Default = 50, Decimals = 1, Callback = function(v) if jptoggle:Get() then hum.JumpPower = v end end})
local hheighttoggle = PlayerSection:Toggle({Name = "HipHeight", Default = false, Callback = function(v) updateHipHeight(v) end})
local hheightslider = PlayerSection:Slider({Name = "HipHeight Value", Min = 0.1, Max = 10, Suffix = "studs", Default = 2, Decimals = 1, Callback = function(v) if hheighttoggle:Get() then hum.HipHeight = v end end})
local msatoggle = PlayerSection:Toggle({Name = "No Mountain Slip", Default = false, Callback = function(v) updateNoSlip(v) end})
local doublejumptoggle = PlayerSection:Toggle({Name = "Double Jump", Default = false, Callback = function(v) updateDoubleJump(v) end})

local UtilitySection = MainPage:Section({Name = "Utilities", Side = 2})
UtilitySection:Button({Name = "Reset Character", Callback = function() if char then char:BreakJoints() end end})

-- =================== COMBAT TAB ===================
local CombatSection = CombatPage:Section({Name = "Kill Aura", Side = 1})

local kauratoggle = CombatSection:Toggle({Name = "Kill Aura", Default = false, Callback = function(v) killAuraEnabled = v end})
local kaurarange = CombatSection:Slider({Name = "Range", Min = 1, Max = 12, Suffix = "studs", Default = 8, Decimals = 1, Callback = function(v) killAuraRange = v end})
local kaumax = CombatSection:Dropdown({Name = "Max Targets", Default = "3", Items = {"1","2","3","4","5","6"}, Callback = function(v) killAuraMaxTargets = tonumber(v) end})
local kaCooldownSlider = CombatSection:Slider({Name = "Attack Cooldown", Min = 0, Max = 1, Suffix = "s", Default = 0.1, Decimals = 1, Callback = function(v) killAuraCooldown = v end})

local AutoHealSection = CombatPage:Section({Name = "Auto Heal & Eat", Side = 2})

local healToggle = AutoHealSection:Toggle({Name = "Auto Heal", Default = false, Callback = function(v) autoHealEnabled = v end})
local healFruit = AutoHealSection:Dropdown({Name = "Heal Fruit", Default = "Bloodfruit", Items = {"Bloodfruit","Bluefruit","Lemon","Coconut","Jelly","Banana","Orange","Berry"}, Callback = function(v) autoHealFruit = v end})
local healThresh = AutoHealSection:Slider({Name = "Heal Below %", Min = 1, Max = 100, Suffix = "%", Default = 90, Callback = function(v) autoHealThreshold = v end})
local eatToggle = AutoHealSection:Toggle({Name = "Auto Eat", Default = false, Callback = function(v) autoEatEnabled = v end})
local eatFruit = AutoHealSection:Dropdown({Name = "Eat Fruit", Default = "Coconut", Items = {"Coconut","Bloodfruit","Bluefruit","Lemon","Jelly","Banana","Orange","Berry"}, Callback = function(v) autoEatFruit = v end})
local eatThresh = AutoHealSection:Slider({Name = "Eat Below %", Min = 1, Max = 100, Suffix = "%", Default = 90, Callback = function(v) autoEatThreshold = v end})
local eatCPS = AutoHealSection:Slider({Name = "Eat Speed (CPS)", Min = 1, Max = 8, Suffix = "cps", Default = 3, Callback = function(v) autoEatCPS = v end})

-- =================== PICKUP TAB ===================
local PickupSection = PickupPage:Section({Name = "Auto Pickup", Side = 1})

local autopickuptoggle = PickupSection:Toggle({Name = "Auto Pickup", Default = false, Callback = function(v) autoPickupEnabled = v end})
local pickuprangeslider = PickupSection:Slider({Name = "Pickup Range", Min = 1, Max = 35, Suffix = "studs", Default = 20, Decimals = 1, Callback = function(v) pickupRange = v end})
local itemdropdown = PickupSection:Dropdown({Name = "Items to Pickup", Default = {"Leaves", "Log"}, Items = allItems, Multi = true, Callback = function(val) selectedItems = {} for item, state in pairs(val) do if state then table.insert(selectedItems, item) end end end})
local custompickuptoggle = PickupSection:Toggle({Name = "Custom Item Pickup", Default = false, Callback = function(v) customPickupEnabled = v end})
local custompickuptextbox = PickupSection:Textbox({Name = "Custom Item Name", Default = "", Placeholder = "Enter item name...", Callback = function(v) customPickupText = v end})

local DropSection = PickupPage:Section({Name = "Auto Drop", Side = 2})

local droptoggle = DropSection:Toggle({Name = "Auto Drop", Default = false, Callback = function(v) autoDropEnabled = v end})
local dropdropdown = DropSection:Dropdown({Name = "Select Item to Drop", Default = "Bloodfruit", Items = allItems, Callback = function(v) dropItem = v end})
local droptogglecustom = DropSection:Toggle({Name = "Auto Drop Custom", Default = false, Callback = function(v) autoDropCustomEnabled = v end})
local droptextbox = DropSection:Textbox({Name = "Custom Item", Default = "Bloodfruit", Placeholder = "...", Callback = function(v) customDropItem = v end})

-- =================== FARMING TAB ===================
local FarmingSection = FarmingPage:Section({Name = "Auto Farming", Side = 1})

local fruitdropdown = FarmingSection:Dropdown({Name = "Select Fruit", Default = "Bloodfruit", Items = {"Bloodfruit", "Bluefruit", "Lemon", "Coconut", "Jelly", "Banana", "Orange", "Berry"}, Callback = function(v) selectedFruit = v end})
local planttoggle = FarmingSection:Toggle({Name = "Auto Plant", Default = false, Callback = function(v) plantToggle = v end})
local plantrangeslider = FarmingSection:Slider({Name = "Plant Range", Min = 1, Max = 30, Suffix = "studs", Default = 30, Decimals = 1, Callback = function(v) plantRange = v end})
local plantdelayslider = FarmingSection:Slider({Name = "Plant Delay (s)", Min = 0.1, Max = 1, Suffix = "s", Default = 0.1, Decimals = 1, Callback = function(v) plantDelay = v end})

-- =================== ESP TAB ===================
local PlayerESPSection = ESPPage:Section({Name = "Player ESP", Side = 1})
local playeresptoggle = PlayerESPSection:Toggle({Name = "Enable Player ESP", Default = false, Callback = function(v) espPlayerEnabled = v if not v then clearPlayerESP() else createESPForAllPlayers() end end})
local esphealth = PlayerESPSection:Toggle({Name = "Show HP", Default = true, Callback = function(v) espShowHP = v end})
local esparmor = PlayerESPSection:Toggle({Name = "Show Armor", Default = true, Callback = function(v) espShowArmor = v end})
local espweapon = PlayerESPSection:Toggle({Name = "Show Weapon", Default = true, Callback = function(v) espShowWeapon = v end})

local CritterESPSection = ESPPage:Section({Name = "Critter ESP", Side = 1})
local critteresptoggle = CritterESPSection:Toggle({Name = "Enable Critter ESP", Default = false, Callback = function(v) espCritterEnabled = v end})

local ResourceESPSection = ESPPage:Section({Name = "Resource ESP", Side = 1})
local resourceesptoggle = ResourceESPSection:Toggle({Name = "Enable Resource ESP", Default = false, Callback = function(v) espResourceEnabled = v end})

local esprange = ESPPage:Slider({Name = "Max Distance (Shared)", Min = 0, Max = 5000, Suffix = "m", Default = 2500, Decimals = 1, Callback = function(v) espMaxDistance = v end})

-- =================== FUNCTIONS ===================
local walkConn, jumpConn, hipConn, slopeConn

function updateWalkspeed(enabled)
    if walkConn then walkConn:Disconnect() end
    if enabled then
        hum.WalkSpeed = wsslider:Get()
        walkConn = runs.RenderStepped:Connect(function() hum.WalkSpeed = wsslider:Get() end)
    else
        hum.WalkSpeed = originalValues.WalkSpeed
    end
end

function updateJumpPower(enabled)
    if jumpConn then jumpConn:Disconnect() end
    if enabled then
        hum.JumpPower = jpslider:Get()
        jumpConn = runs.RenderStepped:Connect(function() hum.JumpPower = jpslider:Get() end)
    else
        hum.JumpPower = originalValues.JumpPower
    end
end

function updateHipHeight(enabled)
    if hipConn then hipConn:Disconnect() end
    if enabled then
        hum.HipHeight = hheightslider:Get()
        hipConn = runs.RenderStepped:Connect(function() hum.HipHeight = hheightslider:Get() end)
    else
        hum.HipHeight = originalValues.HipHeight
    end
end

function updateNoSlip(enabled)
    if slopeConn then slopeConn:Disconnect() end
    if enabled then
        hum.MaxSlopeAngle = 89.9
        slopeConn = runs.RenderStepped:Connect(function() hum.MaxSlopeAngle = 89.9 end)
    else
        hum.MaxSlopeAngle = originalValues.MaxSlopeAngle
    end
end

function updateDoubleJump(enabled)
    for _, c in pairs(doubleJumpConnections) do c:Disconnect() end
    doubleJumpConnections = {}
    if enabled then
        local ground = runs.RenderStepped:Connect(function()
            if hum.FloorMaterial ~= Enum.Material.Air then hasDoubleJumped = false canDoubleJump = true end
        end)
        local input = uis.InputBegan:Connect(function(inp, gp)
            if gp then return end
            if inp.KeyCode == Enum.KeyCode.Space and hum.FloorMaterial == Enum.Material.Air and canDoubleJump and not hasDoubleJumped then
                root.Velocity = Vector3.new(root.Velocity.X, jpslider:Get() * 1.6, root.Velocity.Z)
                hasDoubleJumped = true
                canDoubleJump = false
            end
        end)
        table.insert(doubleJumpConnections, ground)
        table.insert(doubleJumpConnections, input)
    end
end

-- Packet Helpers
local function swingTool(targets)
    if packets and packets.SwingTool then
        packets.SwingTool.send(targets)
    end
end

local function pickupItem(entityId)
    if packets and packets.Pickup then
        packets.Pickup.send(entityId)
    end
end

local function dropItem(layout)
    if packets and packets.DropBagItem then
        packets.DropBagItem.send(layout)
    end
end

local function useBagItem(layout)
    if packets and packets.UseBagItem then
        packets.UseBagItem.send(layout)
    end
end

local function interactStructure(data)
    if packets and packets.InteractStructure then
        packets.InteractStructure.send(data)
    end
end

local function getHealth()
    local label = plr.PlayerGui:FindFirstChild("MainGui") and plr.PlayerGui.MainGui.Panels.Stats.Bars.Health.ValueLabel
    return label and tonumber(label.Text:match("%d+")) or 100
end

local function getHunger()
    local label = plr.PlayerGui:FindFirstChild("MainGui") and plr.PlayerGui.MainGui.Panels.Stats.Bars.Hunger.ValueLabel
    return label and tonumber(label.Text:match("%d+")) or 100
end

local function getInventoryItem(name)
    local inv = plr.PlayerGui:FindFirstChild("MainGui") and plr.PlayerGui.MainGui.RightPanel.Inventory.List
    return inv and inv:FindFirstChild(name)
end

local function isHoeEquipped()
    local tools = char:FindFirstChild("Tools")
    if tools then
        for _, tool in pairs(tools:GetChildren()) do
            if tool.Name:lower():find("hoe") then
                return true
            end
        end
    end
    return false
end

-- ESP Functions
function createPlayerESP(p)
    if p == plr then return end
    local bgui = Instance.new("BillboardGui", game.CoreGui)
    bgui.Name = p.Name .. "_PlayerESP"
    bgui.AlwaysOnTop = true
    bgui.Size = UDim2.new(0, 250, 0, 100)
    bgui.ExtentsOffset = Vector3.new(0, 3.5, 0)

    local container = Instance.new("Frame", bgui)
    container.Size = UDim2.new(1,0,1,0)
    container.BackgroundTransparency = 1

    local nameLabel = Instance.new("TextLabel", container)
    nameLabel.Size = UDim2.new(1,0,0,22)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = 18
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.new(0,0,0)

    local infoLabel = Instance.new("TextLabel", container)
    infoLabel.Position = UDim2.new(0,0,0,22)
    infoLabel.Size = UDim2.new(1,0,0,18)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.GothamBold
    infoLabel.TextSize = 14
    infoLabel.TextStrokeTransparency = 0
    infoLabel.TextStrokeColor3 = Color3.new(0,0,0)

    local conn = runs.RenderStepped:Connect(function()
        local tChar = workspace.Players:FindFirstChild(p.Name)
        if not espPlayerEnabled or not tChar or not tChar:FindFirstChild("HumanoidRootPart") then
            bgui.Enabled = false
            return
        end
        local dist = (tChar.HumanoidRootPart.Position - root.Position).Magnitude
        if dist > espMaxDistance then
            bgui.Enabled = false
            return
        end

        bgui.Adornee = tChar.HumanoidRootPart
        bgui.Enabled = true

        local color = p.TeamColor and p.TeamColor.Color or Color3.fromRGB(255, 255, 255)
        nameLabel.TextColor3 = color
        infoLabel.TextColor3 = color
        nameLabel.Text = p.Name .. " [" .. math.floor(dist) .. "m]"

        local details = {}
        if espShowHP and tChar:FindFirstChild("Humanoid") then
            table.insert(details, "HP: " .. math.floor(tChar.Humanoid.Health))
        end
        if espShowArmor then
            local armor = {}
            for _, v in pairs(tChar:GetChildren()) do
                if v.Name:lower():find("chest") or v.Name:lower():find("greaves") or v.Name:lower():find("helmet") then
                    table.insert(armor, v.Name:match("^%S+"))
                end
            end
            if #armor > 0 then
                table.insert(details, "A: " .. table.concat(armor, "/"))
            else
                table.insert(details, "A: None")
            end
        end
        if espShowWeapon then
            local tools = tChar:FindFirstChild("Tools")
            local weapon = tools and (tools:FindFirstChildWhichIsA("Model") or tools:FindFirstChildWhichIsA("BasePart"))
            table.insert(details, "W: " .. (weapon and weapon.Name or "None"))
        end
        infoLabel.Text = table.concat(details, " â€¢ ")
    end)
    return conn
end

function createESPForAllPlayers()
    for _, p in pairs(game.Players:GetPlayers()) do
        createPlayerESP(p)
    end
end

function clearPlayerESP()
    for _, p in pairs(game.Players:GetPlayers()) do
        local esp = game.CoreGui:FindFirstChild(p.Name .. "_PlayerESP")
        if esp then esp:Destroy() end
    end
end

-- Critter & Resource ESP Loop
task.spawn(function()
    while task.wait(1) do
        if espCritterEnabled then
            for _, obj in pairs(workspace.Critters:GetChildren()) do
                if obj:IsA("Model") and not game.CoreGui:FindFirstChild(obj.Name .. "_CritterESP") then
                    local bgui = Instance.new("BillboardGui", game.CoreGui)
                    bgui.Name = obj.Name .. "_CritterESP"
                    bgui.AlwaysOnTop = true
                    bgui.Size = UDim2.new(0, 200, 0, 50)
                    bgui.ExtentsOffset = Vector3.new(0, 3, 0)

                    local label = Instance.new("TextLabel", bgui)
                    label.Size = UDim2.new(1,0,1,0)
                    label.BackgroundTransparency = 1
                    label.TextColor3 = Color3.fromRGB(0,255,0)
                    label.TextStrokeTransparency = 0
                    label.TextStrokeColor3 = Color3.new(0,0,0)
                    label.Font = Enum.Font.GothamBold
                    label.TextSize = 16

                    runs.RenderStepped:Connect(function()
                        local part = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
                        if not espCritterEnabled or not part then bgui.Enabled = false return end
                        local dist = (part.Position - root.Position).Magnitude
                        if dist > espMaxDistance then bgui.Enabled = false return end
                        bgui.Adornee = part
                        bgui.Enabled = true
                        label.Text = obj.Name .. " [" .. math.floor(dist) .. "m]"
                    end)
                end
            end
        end

        if espResourceEnabled then
            for _, obj in pairs(workspace.Resources:GetChildren()) do
                if obj:IsA("Model") and not game.CoreGui:FindFirstChild(obj.Name .. "_ResourceESP") then
                    local bgui = Instance.new("BillboardGui", game.CoreGui)
                    bgui.Name = obj.Name .. "_ResourceESP"
                    bgui.AlwaysOnTop = true
                    bgui.Size = UDim2.new(0, 200, 0, 50)
                    bgui.ExtentsOffset = Vector3.new(0, 3, 0)

                    local label = Instance.new("TextLabel", bgui)
                    label.Size = UDim2.new(1,0,1,0)
                    label.BackgroundTransparency = 1
                    label.TextColor3 = Color3.fromRGB(255,255,0)
                    label.TextStrokeTransparency = 0
                    label.TextStrokeColor3 = Color3.new(0,0,0)
                    label.Font = Enum.Font.GothamBold
                    label.TextSize = 16

                    runs.RenderStepped:Connect(function()
                        local part = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
                        if not espResourceEnabled or not part then bgui.Enabled = false return end
                        local dist = (part.Position - root.Position).Magnitude
                        if dist > espMaxDistance then bgui.Enabled = false return end
                        bgui.Adornee = part
                        bgui.Enabled = true
                        label.Text = obj.Name .. " [" .. math.floor(dist) .. "m]"
                    end)
                end
            end
        end
    end
end)

-- Kill Aura
task.spawn(function()
    while task.wait(killAuraCooldown) do
        if killAuraEnabled then
            local targets = {}
            for _, p in pairs(game.Players:GetPlayers()) do
                if p ~= plr then
                    local folder = workspace.Players:FindFirstChild(p.Name)
                    if folder then
                        local eid = folder:GetAttribute("EntityID")
                        local hrp = folder:FindFirstChild("HumanoidRootPart")
                        if eid and hrp then
                            local dist = (hrp.Position - root.Position).Magnitude
                            if dist <= killAuraRange then
                                table.insert(targets, {eid = eid, dist = dist})
                            end
                        end
                    end
                end
            end
            if #targets > 0 then
                table.sort(targets, function(a,b) return a.dist < b.dist end)
                local selected = {}
                for i=1, math.min(#targets, killAuraMaxTargets) do
                    table.insert(selected, targets[i].eid)
                end
                swingTool(selected)
            end
        end
    end
end)

-- Auto Heal/Eat
task.spawn(function()
    while task.wait(0.05) do
        local delay = 1 / autoEatCPS
        if tick() - lastUseTime < delay then continue end

        if autoHealEnabled then
            local hp = getHealth()
            if hp < autoHealThreshold then
                local item = getInventoryItem(autoHealFruit)
                if item then
                    useBagItem(item.LayoutOrder)
                    lastUseTime = tick()
                end
            end
        end

        if autoEatEnabled then
            local hunger = getHunger()
            if hunger < autoEatThreshold then
                local item = getInventoryItem(autoEatFruit)
                if item then
                    useBagItem(item.LayoutOrder)
                    lastUseTime = tick()
                end
            end
        end
    end
end)

-- Auto Pickup
task.spawn(function()
    while task.wait(0.1) do
        if autoPickupEnabled then
            for _, item in pairs(workspace.Items:GetChildren()) do
                if item:IsA("BasePart") or item:IsA("MeshPart") then
                    local itemName = item.Name
                    local eid = item:GetAttribute("EntityID")
                    if eid then
                        local should = false
                        if customPickupEnabled and customPickupText ~= "" and itemName:lower():find(customPickupText:lower()) then
                            should = true
                        elseif table.find(selectedItems, itemName) then
                            should = true
                        end
                        if should then
                            local dist = (item.Position - root.Position).Magnitude
                            if dist <= pickupRange then
                                pickupItem(eid)
                            end
                        end
                    end
                end
            end
        end
    end
end)

-- Auto Drop
task.spawn(function()
    while task.wait(0.3) do
        local inv = plr.PlayerGui:FindFirstChild("MainGui") and plr.PlayerGui.MainGui.RightPanel.Inventory.List
        if not inv then continue end

        if autoDropEnabled then
            local item = inv:FindFirstChild(dropItem)
            if item then
                dropItem(item.LayoutOrder)
            end
        end
        if autoDropCustomEnabled then
            local item = inv:FindFirstChild(customDropItem)
            if item then
                dropItem(item.LayoutOrder)
            end
        end
    end
end)

-- Auto Plant (New Method with Hoe)
task.spawn(function()
    while task.wait(plantDelay) do
        if plantToggle and isHoeEquipped() then
            for _, dep in pairs(workspace.Deployables:GetChildren()) do
                if dep.Name == "Plant Box" and not dep:FindFirstChild("Seed") then
                    local eid = dep:GetAttribute("EntityID")
                    local part = dep.PrimaryPart
                    if eid and part then
                        local dist = (part.Position - root.Position).Magnitude
                        if dist <= plantRange then
                            swingTool({eid})
                        end
                    end
                end
            end
        elseif plantToggle then
            -- Fallback to old method if no hoe
            for _, dep in pairs(workspace.Deployables:GetChildren()) do
                if dep.Name == "Plant Box" and not dep:FindFirstChild("Seed") then
                    local eid = dep:GetAttribute("EntityID")
                    local itemId = fruitToItemId[selectedFruit] or 94
                    local part = dep.PrimaryPart
                    if eid and part then
                        local dist = (part.Position - root.Position).Magnitude
                        if dist <= plantRange then
                            interactStructure({entityID = eid, itemID = itemId})
                        end
                    end
                end
            end
        end
    end
end)

-- Character Added
plr.CharacterAdded:Connect(function(new)
    char = new
    root = new:WaitForChild("HumanoidRootPart")
    hum = new:WaitForChild("Humanoid")
    originalValues = {WalkSpeed = hum.WalkSpeed, JumpPower = hum.JumpPower, HipHeight = hum.HipHeight, MaxSlopeAngle = hum.MaxSlopeAngle}
    canDoubleJump = false
    hasDoubleJumped = false
    if wstoggle:Get() then updateWalkspeed(true) end
    if jptoggle:Get() then updateJumpPower(true) end
    if hheighttoggle:Get() then updateHipHeight(true) end
    if msatoggle:Get() then updateNoSlip(true) end
    if doublejumptoggle:Get() then updateDoubleJump(true) end
end)

game.Players.PlayerAdded:Connect(createPlayerESP)
game.Players.PlayerRemoving:Connect(function(p)
    local esp = game.CoreGui:FindFirstChild(p.Name .. "_PlayerESP")
    if esp then esp:Destroy() end
end)

createESPForAllPlayers()

Library:Notification({Title = "Nevox BBR Loaded", Description = "All features ready!", Duration = 5})

Window:Init()
getgenv().Library = Library
